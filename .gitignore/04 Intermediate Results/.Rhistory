select_FB <- paste0(as.character(d$ist9_4),as.character( d$ist6))   # Konvertierung in einen String und Zusammenfuehrung der Variablen ist9_4((Bau der Kellerdecke/des Fußbodens bis zum Boden (wenn kein Keller vorhanden ist)) und ist6(YBaujahr des Gebaeudes) in eine Variable
# Convert in string and merge in one variable variables ist9_4(Construction basement ceiling/floor to the ground (if there is no basement).) and ist6(Year of construction of the building)
u_FBO <-  setDT(u_fb_long, key = 'selection')[J(select_FB)][,ur_u_wert] # Erstellt einen Datatable aus der R-Skript-Tabellenvariable ur_u_wert / Creates datatable from Parameters R script table variable ur_u_wert
u_FBI <- u_FBO
}
###############################################################################
#
# Title: 00 Master Datei / Master data
#
# Beschreibung: Masterdatei fuer die Ausfuehrung aller Skripte zur Berechnung des Endenergiebedarfs
#
# Description: Master file for executing all scripts for final energy demand calculation
#
# Last update: 24 June 2024
# Authors: Maximilian Dreher, Rene Ladwig, Martina Milcetic
#
###############################################################################
# Bereinigung der Arbeitsumgebung / Cleaning up the working environment
rm(list = ls())
# Wechsel in Verzeichnis des Master Files / Change to the directory of the master file
setwd(dirname(rstudioapi::getActiveDocumentContext()$path))
# Wechsel in Hauptordner / Change to main folder
setwd('..')
# Basispfad / Base path
user <- getwd()
# Liste benoetigter Bibliotheken / List of required libraries
my_packages <- c("gdata", "sjmisc", "labelled", "data.table", "readxl", "haven", "foreign",
"stringr","tidyverse", "dplyr", "xlsx", "sjlabelled", "openxlsx")
# Pakete installieren, wenn noch nicht vorhanden / Installation of packages if not already done
install_packages_from_directory <- function(destdir) {
tarballs <- list.files(destdir, pattern = "\\.tar\\.gz$", full.names = TRUE)
for (tarball in tarballs) {
install.packages(tarball, repos = NULL, type = "source")
}
}
install_packages_from_directory("~/R_packages")
# Pakete laden / Load packages
library(data.table, warn.conflicts = FALSE)
library(readxl, warn.conflicts = FALSE)
library(haven, warn.conflicts = FALSE)
library(foreign, warn.conflicts = FALSE)
library(stringr, warn.conflicts = FALSE)
library(tidyverse, warn.conflicts = FALSE)
library(dplyr, warn.conflicts = FALSE)
library(xlsx, warn.conflicts = FALSE)
library(sjlabelled, warn.conflicts = FALSE)
library(openxlsx, warn.conflicts = FALSE)
library(labelled, warn.conflicts = FALSE)
library(sjmisc, warn.conflicts = FALSE)
library(gdata, warn.conflicts = FALSE)
# Source Files aus Ordner 03 R Code / Source files from folder 03 R Code
setwd(dirname(rstudioapi::getActiveDocumentContext()$path))
###############################################################################
#
# Title: 04 Bilanz Gebaeude / Building balance sheet
#
# Beschreibung: Dieses Skript ermittelt den Heizbedarf des Gebaeudes durch
# Berechnung der Transmissionswaermeverlustes und des Lueftungswaermeverlustes.
#
# Description: This script determine the building's heating requirements by
# calculating the transmission heat and ventilation heat loss.
#
#
###############################################################################
# ----------------------------------------------------------------------------
### 0. Pfadangabe / Path specification
# ----------------------------------------------------------------------------
# Bereinigung der Datenumgebung
# Clean up the data environment
rm(list=setdiff(ls(), c("user")))
# Setzt das Arbeitsverzeichnis auf das in der Variablen user gespeicherte Verzeichnis
# Sets the working directory to the directory stored in variable user
setwd(user)
# Arbeitsverzeichnis in 04 Zwischenergebnisse aendern
# Change working directory to 04 Intermediate results
setwd("04 Zwischenergebnisse")
###############################################################################
# ----------------------------------------------------------------------------
### 1. Daten laden / Load data
# ----------------------------------------------------------------------------
load("02 Datentabellen.RData")
load("01_2 bereinigte Daten.Rdata")
# Einige Datensaetze und Objekte behalten / Keep some datasets and objects
keep(d, user, u_aw_long, u_da_long, u_fb_long, u_og_long, u_fe_long, g_fe_long, klima_final, run_missing_imputation, run_kfw_imputation, sure=TRUE)
###############################################################################
# ----------------------------------------------------------------------------
### 2. Parameterauswahl / Parameter selection
# ----------------------------------------------------------------------------
# Fassadenflaechenkoeffizienten / Facade surface coefficients
# Quelle/Source: IWU (3)
q_Fa <- d$ist1          # ist1: "angrenzende Gebaeude"  / is1: "adjacent buildings"
q_Fa[q_Fa == 1] <- 50   # freistehend / freestanding
q_Fa[q_Fa == 2] <- 30   # einseitig direkt angrenzendes Gebaude / directly adjacent building on one side
q_Fa[q_Fa == 3] <- 10   # beidseitig direkt angrenzendes Gebaude / directly adjacent building on both sides
q_Fa[q_Fa == -1] <- 30  # keine Angabe / not specified
# Fassadenflaechenkoeffizienten nach Grundriss / Facade surface coefficient according to floor plan
# Quelle/Source: IWU (3)
p_Fa <- d$ist2            # ist2: "Gebaeudegrundriss" / is2 "Building floor plan"
p_Fa[p_Fa == 1] <- 0.66   # kompakt / kompakt
p_Fa[p_Fa == 2] <- 0.8    # langgestreckt, gewinkelt oder komplizierter / elongated, angled or more complicated
p_Fa[p_Fa == -1] <- 0.66  # keine Angabe / not specified
# Teilbeheizungsgrad Dachgeschoss fuer Schraegdach / Heating level of roof coefficient
# Quelle/Source: IWU (3)
f_TBDG <- d$ist7_1a         # ist7_1a: "Dachgeschoss Teilbeheizungsgrad" / "Attic floor Partial heating level"
f_TBDG[f_TBDG == -2] <- 0   # fehlender Wert, Annahme unbeheizt / missing value, assumption unheated
f_TBDG[f_TBDG == 3] <- 0    # unbeheizt / unheated
f_TBDG[f_TBDG == 1] <- 1    # voll beheizt / Fully heated
f_TBDG[f_TBDG == 2] <- 0.5  # teilweise beheizt / Partially heated
f_TBDG[f_TBDG == -1] <- 0.5 # Weiß nicht, Annahme teilweise beheizt / Don't know, assumption partially heated
# Dachflaechenkoeffizient fuer Schraegdach / Roof area coefficient
# Quelle/Source: IWU (3)
p_Da <- d$ist7_1a         # ist7_1a "Dachgeschoss Teilbeheizungsgrad" / "Attic floor Partial heating level"
p_Da[p_Da == 1] <- 1.5    # Dachgeschoss voll beheizt / Attic fully heated
p_Da[p_Da == 2] <- 0.75   # Dachgeschoss teilweise beheizt / Attic partially heated
p_Da[p_Da == 3] <- 0      # Dachgeschoss unbeheizt / Attic unheated
p_Da[p_Da == -2] <- 1.33  # Flachdach oder fehlender Wert / Flat roof or missing value
p_Da[p_Da == -1] <- 0.75  # Weiß Nicht / Don't know
# Obergeschossflaechenkoeffizienten / Top floor area coefficients
# Quelle/Source: IWU (3)
p_OG <- d$ist7_1a         # ist7_1a "Dachgeschoss Teilbeheizungsgrad" / "Top floor Partial heating level"
p_OG[p_OG == 1] <- 0      # Schraegdach und Dachgeschoss voll beheizt/ Fully heated roof and attic
p_OG[p_OG == 2] <- 0.67   # Schraegdach un Dachgeschoss teilweise beheizt / Sloping roof and attic partially heated
p_OG[p_OG == 3] <- 1.33   # Schraegdach und Dachgeschoss unbeheizt / Unheated roof and attic
p_OG[p_OG == -2] <- 0     # Flachdach oder fehlender Wert / Flat roof or missing value
p_OG[p_OG == -1] <- 0.67  # Weiß Nicht / Don't know
# Korrekturfaktor Gauben / Correction factor for dormers
# Quelle/Source: IWU (3)
f_Ga <- ifelse(d$ist7_1b == 1, 1.3, 1) # ist7_1b: "Gaubenfenster {J,N}" / ist7_1b: "Dormer windows {Y,N}"
# Teilbeheizungsgrad Kellergeschoss / Heating level of basement coefficient
# Quelle/Source: IWU (3)
f_TBKG <- d$ist8              # ist8: "Teilbeheizungsgrad Kellergeschoss" / "Partial heating of basement"
f_TBKG[f_TBKG == 1] <- 1      # voll beheizter Keller / Fully heated cellar
f_TBKG[f_TBKG == 2] <- 0.5    # teilweise beheizter Keller / Partially heated cellar
f_TBKG[f_TBKG == 3] <- 0      # Unbeheizter Keller / Unheated cellar
f_TBKG[f_TBKG == 4] <- 0      # nicht unterkellert / No basement
f_TBKG[f_TBKG == -1] <- 0.5   # weiß nicht / keine Angabe / don't know / no answer
# Luftvolumenfaktor / Heights of the rooms
# Quelle/ Source: IWU (3)
f_L <- ifelse(d$ist3 > 2, 2.5, 2.375) # Variable fuer die Anzahl der Wohneinheiten erstellen / Create variable for number of residential units
# Daemmungsgrad Dach / Roof insulation
f_DDa <- d$ist15_1          # ist15_1: "Daemmungsgrad Dach" / "Roof insulation"
f_DDa[f_DDa == 1] <- 0      # keine Daemmung / No insulation
f_DDa[f_DDa == 2] <- 0.25   # 25 % gedaemmt / 25 % insulated
f_DDa[f_DDa == 3] <- 0.5    # 50% gedaemmt / 50 % insulated
f_DDa[f_DDa == 4] <- 0.75   # 75% gedaemmt / 75 % insulated
f_DDa[f_DDa == 5] <- 1      # komplett gedaemmt / Fully insulated
f_DDa[f_DDa == -1] <- 0     # keine Angabe / not specified
# Daemmungsgrad Obergeschoss / Insulation level OG
f_DOG <- d$ist15_2          # ist15_2: "Daemmungsgrad oberste Geschossdecke" / "Degree of insulation of top story ceiling"
f_DOG[f_DOG == 1] <- 0      # keine Daemmung / No insulation
f_DOG[f_DOG == 2] <- 0.25   # 25 % gedaemmt / 25 % insulated
f_DOG[f_DOG == 3] <- 0.5    # 50 % gedaemmt / 50 % insulated
f_DOG[f_DOG == 4] <- 0.75   # 75 % gedaemmt / 75 % insulated
f_DOG[f_DOG == 5] <- 1      # komplett gedaemmt / Fully insulated
f_DOG[f_DOG == -1] <- 0     # keine Angabe / not specified
f_DOG[f_DOG == -2] <- 0     # falls Dachgeschoss teilweise beheizt: Daemmung Dach relevant, daher setze f_DOG = 0 / if attic is partially heated: Insulation roof relevant, therefore set f_DOG = 0
# Daemmungsgrad Außenwaende /  Insulation level external walls
f_DAW <- d$ist15_3          # ist15_3: "Daemmungsgrad Außenwaende" / "Degree of insulation external walls"
f_DAW[f_DAW == 1] <- 0      # keine Daemmung / No insulation
f_DAW[f_DAW == 2] <- 0.25   # 25 % gedaemmt / 25 % insulated
f_DAW[f_DAW == 3] <- 0.5    # 50 % gedaemmt / 50 % insulated
f_DAW[f_DAW == 4] <- 0.75   # 75 % gedaemmt / 75 % insulated
f_DAW[f_DAW == 5] <- 1      # komplett gedaemmt / Fully insulated
f_DAW[f_DAW == -1] <- 0     # keine Angabe / not specified
# Daemmungsgrad Kellergeschoss / Insulation level basement
f_DFB <- d$ist15_4          # ist15_4: "Daemmungsgrad Kellerdecke / Fußboden zum Erdreich" / "Degree of insulation of basement ceiling / floor to ground"
f_DFB[f_DFB == 1] <- 0      # keine Daemmung / No insulation
f_DFB[f_DFB == 2] <- 0.25   # 25 % gedaemmt / 25 % insulated
f_DFB[f_DFB == 3] <- 0.5    # 50 % gedaemmt / 50 % insulated
f_DFB[f_DFB == 4] <- 0.75   # 75 % gedaemmt / 75 % insulated
f_DFB[f_DFB == 5] <- 1      # komplett gedaemmt / Fully insulated
f_DFB[f_DFB == -1] <- 0     # keine Angabe / not specified
########
# 2.1 Parameterauswahl fuer U-Werte / Parameters selection for U-values
########
### Werte fuer das Dach / Roof values
# Fuer Berechnung der Dach-U-Werte wird eine nachtraegliche Daemmstaerke von 20 cm angenommen
# For roof U-values calculation we assume 20cm subsequent insulation thickness
ins_roof <- 20
# Richtlinien fuer Bundesmittel fuer effiziente Gebaeude legen technische Mindestanforderungen fuer Daecher fest
# Guidelines for federal funding for efficient buildings set min. technical requirement for roof
# Quelle/Source: BEG EM (1)
u_roof_min <- 0.14
# Technische Ausfuehrung des Referenzgebaeudes (Wohngebaeude) im GEG-Gesetz - Referenz-U-Wert fuer Dach
# Technical execution of the reference building (residential building) in GEG law - reference u value for roof
# Quelle/Source: GEG (2)
u_roof_ref <- 0.2
### Werte fuer das Obergeschoss / Upper floor values
# Fuer die Berechnung der U-Werte im Obergeschoss gehen wir von einer nachtraeglichen Daemmstaerke von 20 cm aus
# For upper_floor U-values calculation we assume 20cm subsequent insulation thickness
ins_uf <- 20
# Richtlinien fuer die Bundesfoerderung effizienter Gebaeude legen technische Mindestanforderungen fuer Obergeschosse fest
# Guidelines for federal funding for efficient buildings set min technical requirement for upper floor
# Quelle/Source: BEG EM (1)
u_uf_min <- 0.14
# Technische Ausfuehrung des Referenzgebaeudes (Wohngebaeude) im GEG-Gesetz - Referenz-U-Wert fuer das Obergeschoss
# Technical execution of the reference building (residential building) in GEG law - reference u value for upper floor
# Quelle/Source: GEG (2)
u_uf_ref <- 0.2
### Werte fuer die Außenwand /  Exterior walls values
# Fuer die Berechnung der U-Werte der Außenwaende gehen wir von einer nachtraeglichen Daemmstaerke von 20 cm aus
# For exterior walls U-values calculation we assume 20cm subsequent insulation thickness
ins_wall <- 20
# Richtlinien fuer die Bundesfoerderung von effizienten Gebaeuden legen technische Mindestanforderungen fuer Außenwaende fest
# Guidelines for federal funding for efficient buildings set min technical requirement for exterior wall
# Quelle/Source: BEG EM (1)
u_wall_min <- 0.2
# Technische Ausfuehrung des Referenzgebaeudes (Wohngebaeude) im GEG-Gesetz - Referenz-U-Wert fuer Außenwand
# Technical execution of the reference building (residential building) in GEG law - reference u value for exterior wall
# Quelle/Source: GEG (2)
u_wall_ref <- 0.28
### Werte fuer den Fußboden / Floor values values
# Fuer die Berechnung der Boden-U-Werte gehen wir von einer nachtraeglichen Daemmstaerke von 13 cm aus
# For floor U-values calculation we assume 13cm subsequent insulation thickness
ins_floor <- 13
# Richtlinien fuer die Bundesfoerderung effizienter Gebaeude legen technische Mindestanforderungen fuer den Boden fest
# Guidelines for federal funding for efficient buildings set min technical requirement for floor
# Quelle/Source: BEG EM (1)
u_floor_min <- 0.25
# Technische Ausfuehrung des Referenzgebaeudes (Wohngebaeude) im GEG-Gesetz - Referenz-U-Wert fuer Boden
# Technical execution of the reference building (residential building) in GEG law - reference u value for floor
# Quelle/Source: GEG (2)
u_floor_ref <- 0.35
########
# 2.2 Parameterauswahl fuer Gebaeudeberechnungen / Parameters selection for Building Calculations
########
# Parameter Bodenflaeche  / Floor surface parameter
# Quelle / Source: IWU (3)
p_fb <- 1.33
# Parameter der Fensteroberflaeche / Window surface parameter
# Quelle / Source: IWU (3)
p_fe <- 0.2
########
# 2.3 Auswahl der Parameter fuer den Transmissionswaermeverlust / Parameters selection for Transmission heat loss
########
## Korrekturfaktoren fuer die Temperatur / Temperature correction factors:
# Reduktionsfaktor fuer das oberste Stockwerk / reduction factor for Top floor
# Quelle / Source: IWU (3)
Ft_OG <- 0.8
# Reduktionsfaktor fuer Außenwand gegen Boden / Reduction factor for External wall against ground
# Quelle / Source: IWU (3)
Ft_AW <- 0.6
# Reduktionsfaktor fuer unterste Etage / Reduction factor for lowest floor
# Quelle / Source: IWU (3)
Ft_FB <- 0.6
## U-Wert fuer Waermebrueckenverluste / U-value for thermal bridge losses
# Quelle / Source: IWU (3)
U_WBZ <- 0.10
########
# 2.4 Auswahl der Parameter fuer den Lueftungswaermeverlust / Parameters selection for Ventilation heat loss
########
# Raum-Solltemperatur / Room target temperature
# Quelle / Source: IWU (3)
theta_Soll <- 19
# Reduktionsfaktor fuer zeitlich begrenztes Heizen / Reduction factor for temporally restricted heating
# Quelle / Source: IWU (3)
f_z <- 0.95
# Reduktionsfaktor fuer raeumlich begrenzte Heizung / Reduction factor for spatially restricted heating
# Quelle / Source: IWU (3)
f_r <- 1
# NUtzungsfaktor / Usage factor
# Quelle / Source: IWU (3)
f_n <- 1
# Einen einzelnen Faktor erstellen / Create one factor
f_zrn = f_z* f_r *f_n
# Wirkungsgrad der Heizung / Efficiency factor for heating
# Quelle / Source: IWU (3)
eta_G <- 0.95
setwd(dirname(rstudioapi::getActiveDocumentContext()$path))
# Set a global variable to control the execution of a re-coding of missing values part in 01 WuW Daten script
run_missing_imputation <<- TRUE
# Codes laufen lassen / Run the code
source("01_WuW Daten.R")
source("02_Parameter_einzeln.R")
source("03_Anlagentechnik.R")
###############################################################################
#
# Title: 04 Bilanz Gebaeude / Building balance sheet
#
# Beschreibung: Dieses Skript ermittelt den Heizbedarf des Gebaeudes durch
# Berechnung der Transmissionswaermeverlustes und des Lueftungswaermeverlustes.
#
# Description: This script determine the building's heating requirements by
# calculating the transmission heat and ventilation heat loss.
#
#
###############################################################################
# ----------------------------------------------------------------------------
### 0. Pfadangabe / Path specification
# ----------------------------------------------------------------------------
# Bereinigung der Datenumgebung
# Clean up the data environment
rm(list=setdiff(ls(), c("user")))
# Setzt das Arbeitsverzeichnis auf das in der Variablen user gespeicherte Verzeichnis
# Sets the working directory to the directory stored in variable user
setwd(user)
# Arbeitsverzeichnis in 04 Zwischenergebnisse aendern
# Change working directory to 04 Intermediate results
setwd("04 Zwischenergebnisse")
###############################################################################
# ----------------------------------------------------------------------------
### 1. Daten laden / Load data
# ----------------------------------------------------------------------------
load("02 Datentabellen.RData")
load("01_2 bereinigte Daten.Rdata")
# Einige Datensaetze und Objekte behalten / Keep some datasets and objects
keep(d, user, u_aw_long, u_da_long, u_fb_long, u_og_long, u_fe_long, g_fe_long, klima_final, run_missing_imputation, run_kfw_imputation, sure=TRUE)
###############################################################################
# ----------------------------------------------------------------------------
### 2. Parameterauswahl / Parameter selection
# ----------------------------------------------------------------------------
# Fassadenflaechenkoeffizienten / Facade surface coefficients
# Quelle/Source: IWU (3)
q_Fa <- d$ist1          # ist1: "angrenzende Gebaeude"  / is1: "adjacent buildings"
q_Fa[q_Fa == 1] <- 50   # freistehend / freestanding
q_Fa[q_Fa == 2] <- 30   # einseitig direkt angrenzendes Gebaude / directly adjacent building on one side
q_Fa[q_Fa == 3] <- 10   # beidseitig direkt angrenzendes Gebaude / directly adjacent building on both sides
q_Fa[q_Fa == -1] <- 30  # keine Angabe / not specified
# Fassadenflaechenkoeffizienten nach Grundriss / Facade surface coefficient according to floor plan
# Quelle/Source: IWU (3)
p_Fa <- d$ist2            # ist2: "Gebaeudegrundriss" / is2 "Building floor plan"
p_Fa[p_Fa == 1] <- 0.66   # kompakt / kompakt
p_Fa[p_Fa == 2] <- 0.8    # langgestreckt, gewinkelt oder komplizierter / elongated, angled or more complicated
p_Fa[p_Fa == -1] <- 0.66  # keine Angabe / not specified
# Teilbeheizungsgrad Dachgeschoss fuer Schraegdach / Heating level of roof coefficient
# Quelle/Source: IWU (3)
f_TBDG <- d$ist7_1a         # ist7_1a: "Dachgeschoss Teilbeheizungsgrad" / "Attic floor Partial heating level"
f_TBDG[f_TBDG == -2] <- 0   # fehlender Wert, Annahme unbeheizt / missing value, assumption unheated
f_TBDG[f_TBDG == 3] <- 0    # unbeheizt / unheated
f_TBDG[f_TBDG == 1] <- 1    # voll beheizt / Fully heated
f_TBDG[f_TBDG == 2] <- 0.5  # teilweise beheizt / Partially heated
f_TBDG[f_TBDG == -1] <- 0.5 # Weiß nicht, Annahme teilweise beheizt / Don't know, assumption partially heated
# Dachflaechenkoeffizient fuer Schraegdach / Roof area coefficient
# Quelle/Source: IWU (3)
p_Da <- d$ist7_1a         # ist7_1a "Dachgeschoss Teilbeheizungsgrad" / "Attic floor Partial heating level"
p_Da[p_Da == 1] <- 1.5    # Dachgeschoss voll beheizt / Attic fully heated
p_Da[p_Da == 2] <- 0.75   # Dachgeschoss teilweise beheizt / Attic partially heated
p_Da[p_Da == 3] <- 0      # Dachgeschoss unbeheizt / Attic unheated
p_Da[p_Da == -2] <- 1.33  # Flachdach oder fehlender Wert / Flat roof or missing value
p_Da[p_Da == -1] <- 0.75  # Weiß Nicht / Don't know
# Obergeschossflaechenkoeffizienten / Top floor area coefficients
# Quelle/Source: IWU (3)
p_OG <- d$ist7_1a         # ist7_1a "Dachgeschoss Teilbeheizungsgrad" / "Top floor Partial heating level"
p_OG[p_OG == 1] <- 0      # Schraegdach und Dachgeschoss voll beheizt/ Fully heated roof and attic
p_OG[p_OG == 2] <- 0.67   # Schraegdach un Dachgeschoss teilweise beheizt / Sloping roof and attic partially heated
p_OG[p_OG == 3] <- 1.33   # Schraegdach und Dachgeschoss unbeheizt / Unheated roof and attic
p_OG[p_OG == -2] <- 0     # Flachdach oder fehlender Wert / Flat roof or missing value
p_OG[p_OG == -1] <- 0.67  # Weiß Nicht / Don't know
# Korrekturfaktor Gauben / Correction factor for dormers
# Quelle/Source: IWU (3)
f_Ga <- ifelse(d$ist7_1b == 1, 1.3, 1) # ist7_1b: "Gaubenfenster {J,N}" / ist7_1b: "Dormer windows {Y,N}"
# Teilbeheizungsgrad Kellergeschoss / Heating level of basement coefficient
# Quelle/Source: IWU (3)
f_TBKG <- d$ist8              # ist8: "Teilbeheizungsgrad Kellergeschoss" / "Partial heating of basement"
f_TBKG[f_TBKG == 1] <- 1      # voll beheizter Keller / Fully heated cellar
f_TBKG[f_TBKG == 2] <- 0.5    # teilweise beheizter Keller / Partially heated cellar
f_TBKG[f_TBKG == 3] <- 0      # Unbeheizter Keller / Unheated cellar
f_TBKG[f_TBKG == 4] <- 0      # nicht unterkellert / No basement
f_TBKG[f_TBKG == -1] <- 0.5   # weiß nicht / keine Angabe / don't know / no answer
# Luftvolumenfaktor / Heights of the rooms
# Quelle/ Source: IWU (3)
f_L <- ifelse(d$ist3 > 2, 2.5, 2.375) # Variable fuer die Anzahl der Wohneinheiten erstellen / Create variable for number of residential units
# Daemmungsgrad Dach / Roof insulation
f_DDa <- d$ist15_1          # ist15_1: "Daemmungsgrad Dach" / "Roof insulation"
f_DDa[f_DDa == 1] <- 0      # keine Daemmung / No insulation
f_DDa[f_DDa == 2] <- 0.25   # 25 % gedaemmt / 25 % insulated
f_DDa[f_DDa == 3] <- 0.5    # 50% gedaemmt / 50 % insulated
f_DDa[f_DDa == 4] <- 0.75   # 75% gedaemmt / 75 % insulated
f_DDa[f_DDa == 5] <- 1      # komplett gedaemmt / Fully insulated
f_DDa[f_DDa == -1] <- 0     # keine Angabe / not specified
# Daemmungsgrad Obergeschoss / Insulation level OG
f_DOG <- d$ist15_2          # ist15_2: "Daemmungsgrad oberste Geschossdecke" / "Degree of insulation of top story ceiling"
f_DOG[f_DOG == 1] <- 0      # keine Daemmung / No insulation
f_DOG[f_DOG == 2] <- 0.25   # 25 % gedaemmt / 25 % insulated
f_DOG[f_DOG == 3] <- 0.5    # 50 % gedaemmt / 50 % insulated
f_DOG[f_DOG == 4] <- 0.75   # 75 % gedaemmt / 75 % insulated
f_DOG[f_DOG == 5] <- 1      # komplett gedaemmt / Fully insulated
f_DOG[f_DOG == -1] <- 0     # keine Angabe / not specified
f_DOG[f_DOG == -2] <- 0     # falls Dachgeschoss teilweise beheizt: Daemmung Dach relevant, daher setze f_DOG = 0 / if attic is partially heated: Insulation roof relevant, therefore set f_DOG = 0
# Daemmungsgrad Außenwaende /  Insulation level external walls
f_DAW <- d$ist15_3          # ist15_3: "Daemmungsgrad Außenwaende" / "Degree of insulation external walls"
f_DAW[f_DAW == 1] <- 0      # keine Daemmung / No insulation
f_DAW[f_DAW == 2] <- 0.25   # 25 % gedaemmt / 25 % insulated
f_DAW[f_DAW == 3] <- 0.5    # 50 % gedaemmt / 50 % insulated
f_DAW[f_DAW == 4] <- 0.75   # 75 % gedaemmt / 75 % insulated
f_DAW[f_DAW == 5] <- 1      # komplett gedaemmt / Fully insulated
f_DAW[f_DAW == -1] <- 0     # keine Angabe / not specified
# Daemmungsgrad Kellergeschoss / Insulation level basement
f_DFB <- d$ist15_4          # ist15_4: "Daemmungsgrad Kellerdecke / Fußboden zum Erdreich" / "Degree of insulation of basement ceiling / floor to ground"
f_DFB[f_DFB == 1] <- 0      # keine Daemmung / No insulation
f_DFB[f_DFB == 2] <- 0.25   # 25 % gedaemmt / 25 % insulated
f_DFB[f_DFB == 3] <- 0.5    # 50 % gedaemmt / 50 % insulated
f_DFB[f_DFB == 4] <- 0.75   # 75 % gedaemmt / 75 % insulated
f_DFB[f_DFB == 5] <- 1      # komplett gedaemmt / Fully insulated
f_DFB[f_DFB == -1] <- 0     # keine Angabe / not specified
########
# 2.1 Parameterauswahl fuer U-Werte / Parameters selection for U-values
########
### Werte fuer das Dach / Roof values
# Fuer Berechnung der Dach-U-Werte wird eine nachtraegliche Daemmstaerke von 20 cm angenommen
# For roof U-values calculation we assume 20cm subsequent insulation thickness
ins_roof <- 20
# Richtlinien fuer Bundesmittel fuer effiziente Gebaeude legen technische Mindestanforderungen fuer Daecher fest
# Guidelines for federal funding for efficient buildings set min. technical requirement for roof
# Quelle/Source: BEG EM (1)
u_roof_min <- 0.14
# Technische Ausfuehrung des Referenzgebaeudes (Wohngebaeude) im GEG-Gesetz - Referenz-U-Wert fuer Dach
# Technical execution of the reference building (residential building) in GEG law - reference u value for roof
# Quelle/Source: GEG (2)
u_roof_ref <- 0.2
### Werte fuer das Obergeschoss / Upper floor values
# Fuer die Berechnung der U-Werte im Obergeschoss gehen wir von einer nachtraeglichen Daemmstaerke von 20 cm aus
# For upper_floor U-values calculation we assume 20cm subsequent insulation thickness
ins_uf <- 20
# Richtlinien fuer die Bundesfoerderung effizienter Gebaeude legen technische Mindestanforderungen fuer Obergeschosse fest
# Guidelines for federal funding for efficient buildings set min technical requirement for upper floor
# Quelle/Source: BEG EM (1)
u_uf_min <- 0.14
# Technische Ausfuehrung des Referenzgebaeudes (Wohngebaeude) im GEG-Gesetz - Referenz-U-Wert fuer das Obergeschoss
# Technical execution of the reference building (residential building) in GEG law - reference u value for upper floor
# Quelle/Source: GEG (2)
u_uf_ref <- 0.2
### Werte fuer die Außenwand /  Exterior walls values
# Fuer die Berechnung der U-Werte der Außenwaende gehen wir von einer nachtraeglichen Daemmstaerke von 20 cm aus
# For exterior walls U-values calculation we assume 20cm subsequent insulation thickness
ins_wall <- 20
# Richtlinien fuer die Bundesfoerderung von effizienten Gebaeuden legen technische Mindestanforderungen fuer Außenwaende fest
# Guidelines for federal funding for efficient buildings set min technical requirement for exterior wall
# Quelle/Source: BEG EM (1)
u_wall_min <- 0.2
# Technische Ausfuehrung des Referenzgebaeudes (Wohngebaeude) im GEG-Gesetz - Referenz-U-Wert fuer Außenwand
# Technical execution of the reference building (residential building) in GEG law - reference u value for exterior wall
# Quelle/Source: GEG (2)
u_wall_ref <- 0.28
### Werte fuer den Fußboden / Floor values values
# Fuer die Berechnung der Boden-U-Werte gehen wir von einer nachtraeglichen Daemmstaerke von 13 cm aus
# For floor U-values calculation we assume 13cm subsequent insulation thickness
ins_floor <- 13
# Richtlinien fuer die Bundesfoerderung effizienter Gebaeude legen technische Mindestanforderungen fuer den Boden fest
# Guidelines for federal funding for efficient buildings set min technical requirement for floor
# Quelle/Source: BEG EM (1)
u_floor_min <- 0.25
# Technische Ausfuehrung des Referenzgebaeudes (Wohngebaeude) im GEG-Gesetz - Referenz-U-Wert fuer Boden
# Technical execution of the reference building (residential building) in GEG law - reference u value for floor
# Quelle/Source: GEG (2)
u_floor_ref <- 0.35
########
# 2.2 Parameterauswahl fuer Gebaeudeberechnungen / Parameters selection for Building Calculations
########
# Parameter Bodenflaeche  / Floor surface parameter
# Quelle / Source: IWU (3)
p_fb <- 1.33
# Parameter der Fensteroberflaeche / Window surface parameter
# Quelle / Source: IWU (3)
p_fe <- 0.2
########
# 2.3 Auswahl der Parameter fuer den Transmissionswaermeverlust / Parameters selection for Transmission heat loss
########
## Korrekturfaktoren fuer die Temperatur / Temperature correction factors:
# Reduktionsfaktor fuer das oberste Stockwerk / reduction factor for Top floor
# Quelle / Source: IWU (3)
Ft_OG <- 0.8
# Reduktionsfaktor fuer Außenwand gegen Boden / Reduction factor for External wall against ground
# Quelle / Source: IWU (3)
Ft_AW <- 0.6
# Reduktionsfaktor fuer unterste Etage / Reduction factor for lowest floor
# Quelle / Source: IWU (3)
Ft_FB <- 0.6
## U-Wert fuer Waermebrueckenverluste / U-value for thermal bridge losses
# Quelle / Source: IWU (3)
U_WBZ <- 0.10
########
# 2.4 Auswahl der Parameter fuer den Lueftungswaermeverlust / Parameters selection for Ventilation heat loss
########
# Raum-Solltemperatur / Room target temperature
# Quelle / Source: IWU (3)
theta_Soll <- 19
# Reduktionsfaktor fuer zeitlich begrenztes Heizen / Reduction factor for temporally restricted heating
# Quelle / Source: IWU (3)
f_z <- 0.95
# Reduktionsfaktor fuer raeumlich begrenzte Heizung / Reduction factor for spatially restricted heating
# Quelle / Source: IWU (3)
f_r <- 1
# NUtzungsfaktor / Usage factor
# Quelle / Source: IWU (3)
f_n <- 1
# Einen einzelnen Faktor erstellen / Create one factor
f_zrn = f_z* f_r *f_n
# Wirkungsgrad der Heizung / Efficiency factor for heating
# Quelle / Source: IWU (3)
eta_G <- 0.95
### 3.1.1 U-Wert Dach / Roof U-value (i = Da)
# Importieren des urspruenglichen U-Wertes in Abhaengigkeit vom Baujahr/ Import original U-values dependent on year of construction
select_Da <- paste0(as.character(d$ist9_1),as.character(d$ist6))  # In String umwandeln und in einer Variable zusammenfassen (Variablen ist9_1(Dachkonstruktion) und ist6(Baujahr des Gebaeudes))
# Convert in string and merge in one variable variables ist9_1(Roof construction) and ist6(Year of construction of the building)
u_DaO <-  setDT(u_da_long, key = 'selection')[J(select_Da)][,ur_u_wert] # Erstellt eine Datentabelle aus der Skripttabelle Parameter R. Variable ur_u_wert
# Creates datatable from Parameters R script table variable ur_u_wert
## KfW funding
# Wenn es keine KfW-Foerderung fuer das Dach gab / If NO KfW funding for the roof
u_DaKFW <- as.numeric(d$kfwEM_roo==0) * ((1-f_DDa) * u_DaO + f_DDa * 1/((1/u_DaO) + (ins_roof/4)))
# Wenn es eine KfW-Foerderung fuer das Dach gab / If KfW funding for the roof
u_DaKFW <- u_DaKFW + as.numeric(d$kfwEM_roo==1) * ((1-f_DDa) * u_DaO + f_DDa * 1/((1/u_DaO) + (1/u_roof_min)))
# Wenn KFW-Mittel fuer Komplettsanierung des Hauses / If KFW funds for complete refurbishment of the house
# Quelle / Source: GEG (2) - reference building
u_DaKFW <- as.numeric(d$kfwEH!=1) * u_DaKFW + as.numeric(d$kfwEH==1) * 0.70 * u_roof_ref # Transmissionswaerme fuer ein Effizienzhaus 55 * U-Wert fuer Fußboden aus GEG / Transmission heat for a efficiency house 55 * U-value for roof from GEG
u_DaKFW <- as.numeric(d$kfwEH!=2) * u_DaKFW + as.numeric(d$kfwEH==2) * 0.85 * u_roof_ref # Transmissionswaerme fuer ein Effizienzhaus 70 * U-Wert fuer Fußboden aus GEG / Transmission heat for a efficiency house 70 * U-value for roof from GEG
u_DaKFW <- as.numeric(d$kfwEH!=3) * u_DaKFW + as.numeric(d$kfwEH==3) * 1.00 * u_roof_ref # Transmissionswaerme fuer ein Effizienzhaus 85 * U-Wert fuer Fußboden aus GEG / Transmission heat for a efficiency house 85 * U-value for roof from GEG
u_DaKFW <- as.numeric(d$kfwEH!=4) * u_DaKFW + as.numeric(d$kfwEH==4) * 1.15 * u_roof_ref # Transmissionswaerme fuer ein Effizienzhaus 100 * U-Wert fuer Fußboden aus GEG / Transmission heat for a efficiency house 100 * U-value for roof from GEG
u_DaKFW <- as.numeric(d$kfwEH!=5) * u_DaKFW + as.numeric(d$kfwEH==5) * 1.30 * u_roof_ref # Transmissionswaerme fuer ein Effizienzhaus 115 * U-Wert fuer Fußboden aus GEG / Transmission heat for a efficiency house 115 * U-value for roof from GEG
u_DaI <- u_DaKFW
table(u_Da)
table(u_DaI)
