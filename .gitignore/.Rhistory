for (f in pkg_files) {
install.packages(f, repos = NULL, type = "binary")
}
# Load packages
packages <- c(
"Rcpp", "zip", "data.table", "foreign", "haven",
"labelled", "openxlsx", "readxl", "tidyverse", "dplyr"
)
lapply(packages, library, character.only = TRUE)
# Source files from folder "03 R Code"
setwd(file.path(user, "03 R Code"))
# Define file paths
file_building <- "01 Raw/ariadne_panel_buildingchars_combined_update24.dta"
file_refurb   <- "01 Raw/ariadne_panel_experiments_combined_update24.dta"
# Global flag: control whether 01_WuW_Data recodes missing values
run_missing_imputation <<- FALSE
rules <<- "Fehlende Werte.xlsx"   # Roof, Top Floor, External Walls, Basement
u_werte_all <<- "U Werte Baukonstruktion_update.xlsx"   # Roof, Top Floor, External Walls, Basement
u_werte_f   <<- "U und G Werte Fenster_update.xlsx"     # Windows
# Run the pipeline
source("01_WuW_Data.R")
source("02_Individual_Parameters.R")
source("03_System_Technology.R")
source("04_Building_Balance_Sheet.R")
source("05_System_Balance_Sheet.R")
###############################################################################
#
# Title: 00 Master File
#
# Description: Master file for executing all scripts to calculate final energy demand.
#
# Last update: 24 June 2024
# Authors: Maximilian Dreher, Rene Ladwig, Martina Milcetic (and a little bit Anton Knoche)
#
###############################################################################
# Clean up the working environment
rm(list = ls())
# Change to the directory of this master file
setwd(dirname(rstudioapi::getActiveDocumentContext()$path))
# Change to project root (one level up)
setwd("..")
# Base path
user <- getwd()
# Install packages from local zips if not already present (kept behavior)
pkg_files <- list.files("R packages", pattern = "\\.zip$", full.names = TRUE)
for (f in pkg_files) {
install.packages(f, repos = NULL, type = "binary")
}
# Load packages
packages <- c(
"Rcpp", "zip", "data.table", "foreign", "haven",
"labelled", "openxlsx", "readxl", "tidyverse", "dplyr"
)
lapply(packages, library, character.only = TRUE)
# Source files from folder "03 R Code"
setwd(file.path(user, "03 R Code"))
# Define file paths
file_building <- "01 Raw/ariadne_panel_buildingchars_combined_update24.dta"
file_refurb   <- "01 Raw/ariadne_panel_experiments_combined_update24.dta"
# Global flag: control whether 01_WuW_Data recodes missing values
run_missing_imputation <<- FALSE
rules <<- "Fehlende Werte.xlsx"   # Roof, Top Floor, External Walls, Basement
u_werte_all <<- "U Werte Baukonstruktion_update.xlsx"   # Roof, Top Floor, External Walls, Basement
u_werte_f   <<- "U und G Werte Fenster_update.xlsx"     # Windows
# Run the pipeline
source("01_WuW_Data.R")
source("02_Individual_Parameters.R")
source("03_System_Technology.R")
source("04_Building_Balance_Sheet.R")
source("05_System_Balance_Sheet.R")
setwd("C:/Users/antonkn/Desktop/EBJ/EBJ Package V2")
install.packages("shiny")
install.packages("shiny")
shiny::runApp("app.R")
setwd("C:/Users/antonkn/Desktop/EBJ/EBJ Package V2")
shiny::runApp("app.R")
setwd("C:/Users/antonkn/Desktop/EBJ/EBJ Package V2")
shiny::runApp("app.R")
setwd("C:/Users/antonkn/Desktop/EBJ/EBJ Package V2")
shiny::runApp("app.R")
shiny::runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
shiny::runApp()
source("C:/Users/antonkn/Desktop/EBJ/EBJ Package V2/app.R", echo=TRUE)
runApp()
runApp()
###############################################################################
#
# Title: 00 Master File
#
# Description: Master file for executing all scripts to calculate final energy demand.
#
# Last update: 24 June 2024
# Authors: Maximilian Dreher, Rene Ladwig, Martina Milcetic (and a little bit Anton Knoche)
#
###############################################################################
# Clean up the working environment
rm(list = ls())
# Change to the directory of this master file
setwd(dirname(rstudioapi::getActiveDocumentContext()$path))
# Change to project root (one level up)
setwd("..")
# Base path
user <- getwd()
# Install packages from local zips if not already present (kept behavior)
pkg_files <- list.files("R packages", pattern = "\\.zip$", full.names = TRUE)
for (f in pkg_files) {
install.packages(f, repos = NULL, type = "binary")
}
# Load packages
packages <- c(
"Rcpp", "zip", "data.table", "foreign", "haven",
"labelled", "openxlsx", "readxl", "tidyverse", "dplyr"
)
lapply(packages, library, character.only = TRUE)
# Source files from folder "03 R Code"
setwd(file.path(user, "03 R Code"))
# Define file paths
file_building <- "01 Raw/ariadne_panel_buildingchars_combined_update24.dta"
file_refurb   <- "01 Raw/ariadne_panel_experiments_combined_update24.dta"
# Global flag: control whether 01_WuW_Data recodes missing values
run_missing_imputation <<- TRUE
rules <<- "Fehlende Werte.xlsx"   # Roof, Top Floor, External Walls, Basement
u_werte_all <<- "U Werte Baukonstruktion_update.xlsx"   # Roof, Top Floor, External Walls, Basement
u_werte_f   <<- "U und G Werte Fenster_update.xlsx"     # Windows
# Run the pipeline
source("01_WuW_Data.R")
View(rules)
###############################################################################
#
# Title: 01 WuW Data
#
# Description: In this script, the data from the Waerme- & Wohnen-Panel is
# loaded and processed for the subsequent calculation steps.
#
###############################################################################
library(dplyr)
# ----------------------------------------------------------------------------
# 0. Path specification
# ----------------------------------------------------------------------------
# Save important variables
important_vars <- c("user", "run_missing_imputation", "run_retrofit_imputation", "u_werte_all", "u_werte_f","file_building","file_refurb","rules")
# Clean up the environment
rm(list = setdiff(ls(), important_vars))
# Set working directory
setwd(user)
# ----------------------------------------------------------------------------
# 1. Merge data
# ----------------------------------------------------------------------------
# Select Data for Building characteristics
d1 <- haven::read_dta(file_building)
# Select Data for Refurbishment information (keys need to match)
d2 <- haven::read_dta(file_refurb)
# Merge (full join by = "key")
d <- dplyr::full_join(d1, d2, by = c("key","year_identifier"))
# Sort and reduce to necessary variables (same logic as before)
columns_to_keep <- c("key", "a*", "id", "ist*", "san*", "year_identifier")
columns_to_keep <- unique(unlist(lapply(columns_to_keep, function(x) grep(x, names(d), value = TRUE))))
d <- d %>% dplyr::select(dplyr::all_of(columns_to_keep))
d <- d %>%
select(
key,year_identifier,ist1, ist2, ist3_num, ist4_num, ist5_num, ist5a_num, ist6, ist7_1a, ist7_1b, ist8,
ist9_1, ist9_2, ist9_3, ist9_4, ist10, ist11, ist12, ist12_1a,
ist12_2a, ist12_2b, ist12_3a, ist12_5a, ist13, ist13a, ist13a_1,
ist14, ist14a, ist14b, ist14c, ist15_1, ist15_2, ist15_3,
ist15_4, ist16a_2, san1a_1a, san1a_13_2, san1a_23_2, san1a_33_2,
san1a_43_2,san1a_11,san1a_21,san1a_31,san1a_41
)
# ----------------------------------------------------------------------------
# 2. Data adjustments
# ----------------------------------------------------------------------------
d <- d %>%
dplyr::mutate(
ist3  = ist3_num,
ist4  = ist4_num,
ist5  = ist5_num,
ist5a = ist5a_num
)
# ----------------------------------------------------------------------------
# 3. Identify KfW funding
# ----------------------------------------------------------------------------
d <- d %>%
dplyr::mutate(
kfwEH      = 0L,
kfwEM_roo  = 0L,
kfwEM_tf   = 0L,
kfwEM_ext  = 0L,
kfwEM_base = 0L
) %>%
dplyr::mutate(
kfwEM_roo  = dplyr::if_else(san1a_13_2 == 1L & (san1a_1a == 6L | san1a_1a == -1L), 1L, kfwEM_roo),
kfwEM_tf   = dplyr::if_else(san1a_23_2 == 1L & (san1a_1a == 6L | san1a_1a == -1L), 1L, kfwEM_tf),
kfwEM_ext  = dplyr::if_else(san1a_33_2 == 1L & (san1a_1a == 6L | san1a_1a == -1L), 1L, kfwEM_ext),
kfwEM_base = dplyr::if_else(san1a_43_2 == 1L & (san1a_1a == 6L | san1a_1a == -1L), 1L, kfwEM_base),
kfwEH      = dplyr::if_else(san1a_1a >= 1L & san1a_1a <= 5L, san1a_1a, kfwEH)
)
# ----------------------------------------------------------------------------
# 4. Keep only numeric columns, then cast to numeric
# ----------------------------------------------------------------------------
d <- d %>%
dplyr::arrange(key) %>%
dplyr::select(dplyr::where(is.numeric)) %>%                                        # keep only numeric columns
dplyr::mutate(dplyr::across(dplyr::everything(), ~ suppressWarnings(as.numeric(.)))) %>%  # drop labels
dplyr::mutate(id = dplyr::row_number())
if (exists("run_missing_imputation") && isTRUE(run_missing_imputation)) {
message("Replacing Missing Values...")
# load rules
setwd("02 Parameter")
rules <- read_excel(rules, sheet = "Rules")
# apply rules iteratively
for (var in unique(rules$variable)) {
subrules <- rules %>% filter(variable == var)
for (i in seq_len(nrow(subrules))) {
old <- subrules$old_value[i]
new <- subrules$new_value[i]
d[[var]][d[[var]] == old] <- new
}
}
} else {
message("Skipping missing imputation...")
}
###############################################################################
#
# Title: 00 Master File
#
# Description: Master file for executing all scripts to calculate final energy demand.
#
# Last update: 24 June 2024
# Authors: Maximilian Dreher, Rene Ladwig, Martina Milcetic (and a little bit Anton Knoche)
#
###############################################################################
# Clean up the working environment
rm(list = ls())
# Change to the directory of this master file
setwd(dirname(rstudioapi::getActiveDocumentContext()$path))
# Change to project root (one level up)
setwd("..")
# Base path
user <- getwd()
# Install packages from local zips if not already present (kept behavior)
pkg_files <- list.files("R packages", pattern = "\\.zip$", full.names = TRUE)
for (f in pkg_files) {
install.packages(f, repos = NULL, type = "binary")
}
# Load packages
packages <- c(
"Rcpp", "zip", "data.table", "foreign", "haven",
"labelled", "openxlsx", "readxl", "tidyverse", "dplyr"
)
lapply(packages, library, character.only = TRUE)
# Source files from folder "03 R Code"
setwd(file.path(user, "03 R Code"))
# Define file paths
file_building <- "01 Raw/ariadne_panel_buildingchars_combined_update24.dta"
file_refurb   <- "01 Raw/ariadne_panel_experiments_combined_update24.dta"
# Global flag: control whether 01_WuW_Data recodes missing values
run_missing_imputation <<- TRUE
rules <<- "Fehlende Werte.xlsx"   # Roof, Top Floor, External Walls, Basement
u_werte_all <<- "U Werte Baukonstruktion_update.xlsx"   # Roof, Top Floor, External Walls, Basement
u_werte_f   <<- "U und G Werte Fenster_update.xlsx"     # Windows
###############################################################################
#
# Title: 01 WuW Data
#
# Description: In this script, the data from the Waerme- & Wohnen-Panel is
# loaded and processed for the subsequent calculation steps.
#
###############################################################################
library(dplyr)
# ----------------------------------------------------------------------------
# 0. Path specification
# ----------------------------------------------------------------------------
# Save important variables
important_vars <- c("user", "run_missing_imputation", "run_retrofit_imputation", "u_werte_all", "u_werte_f","file_building","file_refurb","rules")
# Clean up the environment
rm(list = setdiff(ls(), important_vars))
# Set working directory
setwd(user)
# ----------------------------------------------------------------------------
# 1. Merge data
# ----------------------------------------------------------------------------
# Select Data for Building characteristics
d1 <- haven::read_dta(file_building)
# Select Data for Refurbishment information (keys need to match)
d2 <- haven::read_dta(file_refurb)
# Merge (full join by = "key")
d <- dplyr::full_join(d1, d2, by = c("key","year_identifier"))
# Sort and reduce to necessary variables (same logic as before)
columns_to_keep <- c("key", "a*", "id", "ist*", "san*", "year_identifier")
columns_to_keep <- unique(unlist(lapply(columns_to_keep, function(x) grep(x, names(d), value = TRUE))))
d <- d %>% dplyr::select(dplyr::all_of(columns_to_keep))
d <- d %>%
select(
key,year_identifier,ist1, ist2, ist3_num, ist4_num, ist5_num, ist5a_num, ist6, ist7_1a, ist7_1b, ist8,
ist9_1, ist9_2, ist9_3, ist9_4, ist10, ist11, ist12, ist12_1a,
ist12_2a, ist12_2b, ist12_3a, ist12_5a, ist13, ist13a, ist13a_1,
ist14, ist14a, ist14b, ist14c, ist15_1, ist15_2, ist15_3,
ist15_4, ist16a_2, san1a_1a, san1a_13_2, san1a_23_2, san1a_33_2,
san1a_43_2,san1a_11,san1a_21,san1a_31,san1a_41
)
# ----------------------------------------------------------------------------
# 2. Data adjustments
# ----------------------------------------------------------------------------
d <- d %>%
dplyr::mutate(
ist3  = ist3_num,
ist4  = ist4_num,
ist5  = ist5_num,
ist5a = ist5a_num
)
# ----------------------------------------------------------------------------
# 3. Identify KfW funding
# ----------------------------------------------------------------------------
d <- d %>%
dplyr::mutate(
kfwEH      = 0L,
kfwEM_roo  = 0L,
kfwEM_tf   = 0L,
kfwEM_ext  = 0L,
kfwEM_base = 0L
) %>%
dplyr::mutate(
kfwEM_roo  = dplyr::if_else(san1a_13_2 == 1L & (san1a_1a == 6L | san1a_1a == -1L), 1L, kfwEM_roo),
kfwEM_tf   = dplyr::if_else(san1a_23_2 == 1L & (san1a_1a == 6L | san1a_1a == -1L), 1L, kfwEM_tf),
kfwEM_ext  = dplyr::if_else(san1a_33_2 == 1L & (san1a_1a == 6L | san1a_1a == -1L), 1L, kfwEM_ext),
kfwEM_base = dplyr::if_else(san1a_43_2 == 1L & (san1a_1a == 6L | san1a_1a == -1L), 1L, kfwEM_base),
kfwEH      = dplyr::if_else(san1a_1a >= 1L & san1a_1a <= 5L, san1a_1a, kfwEH)
)
# ----------------------------------------------------------------------------
# 4. Keep only numeric columns, then cast to numeric
# ----------------------------------------------------------------------------
d <- d %>%
dplyr::arrange(key) %>%
dplyr::select(dplyr::where(is.numeric)) %>%                                        # keep only numeric columns
dplyr::mutate(dplyr::across(dplyr::everything(), ~ suppressWarnings(as.numeric(.)))) %>%  # drop labels
dplyr::mutate(id = dplyr::row_number())
message("Replacing Missing Values...")
# load rules
setwd("02 Parameter")
rules <- read_excel(rules, sheet = "Rules")
# apply rules iteratively
for (var in unique(rules$variable)) {
subrules <- rules %>% filter(variable == var)
for (i in seq_len(nrow(subrules))) {
old <- subrules$old_value[i]
new <- subrules$new_value[i]
d[[var]][d[[var]] == old] <- new
}
}
View(rules)
###############################################################################
#
# Title: 00 Master File
#
# Description: Master file for executing all scripts to calculate final energy demand.
#
# Last update: 24 June 2024
# Authors: Maximilian Dreher, Rene Ladwig, Martina Milcetic (and a little bit Anton Knoche)
#
###############################################################################
# Clean up the working environment
rm(list = ls())
# Change to the directory of this master file
setwd(dirname(rstudioapi::getActiveDocumentContext()$path))
# Change to project root (one level up)
setwd("..")
# Base path
user <- getwd()
# Install packages from local zips if not already present (kept behavior)
pkg_files <- list.files("R packages", pattern = "\\.zip$", full.names = TRUE)
for (f in pkg_files) {
install.packages(f, repos = NULL, type = "binary")
}
# Load packages
packages <- c(
"Rcpp", "zip", "data.table", "foreign", "haven",
"labelled", "openxlsx", "readxl", "tidyverse", "dplyr"
)
lapply(packages, library, character.only = TRUE)
# Source files from folder "03 R Code"
setwd(file.path(user, "03 R Code"))
# Define file paths
file_building <- "01 Raw/ariadne_panel_buildingchars_combined_update24.dta"
file_refurb   <- "01 Raw/ariadne_panel_experiments_combined_update24.dta"
# Global flag: control whether 01_WuW_Data recodes missing values
run_missing_imputation <<- TRUE
rules <<- "Fehlende Werte.xlsx"   # Roof, Top Floor, External Walls, Basement
u_werte_all <<- "U Werte Baukonstruktion_update.xlsx"   # Roof, Top Floor, External Walls, Basement
u_werte_f   <<- "U und G Werte Fenster_update.xlsx"     # Windows
# Run the pipeline
source("01_WuW_Data.R")
source("02_Individual_Parameters.R")
source("03_System_Technology.R")
source("04_Building_Balance_Sheet.R")
source("05_System_Balance_Sheet.R")
runApp('C:/Users/antonkn/Desktop/EBJ/EBJ Package V2')
runApp('C:/Users/antonkn/Desktop/EBJ/EBJ Package V2')
###############################################################################
#
# Title: 00 Master File
#
# Description: Master file for executing all scripts to calculate final energy demand.
#
# Last update: 24 June 2024
# Authors: Maximilian Dreher, Rene Ladwig, Martina Milcetic (and a little bit Anton Knoche)
#
###############################################################################
# Clean up the working environment
rm(list = ls())
# Change to the directory of this master file
setwd(dirname(rstudioapi::getActiveDocumentContext()$path))
# Change to project root (one level up)
setwd("..")
# Base path
user <- getwd()
# Install packages from local zips if not already present (kept behavior)
pkg_files <- list.files("R packages", pattern = "\\.zip$", full.names = TRUE)
for (f in pkg_files) {
install.packages(f, repos = NULL, type = "binary")
}
# Load packages
packages <- c(
"Rcpp", "zip", "data.table", "foreign", "haven",
"labelled", "openxlsx", "readxl", "tidyverse", "dplyr"
)
lapply(packages, library, character.only = TRUE)
# Source files from folder "03 R Code"
setwd(file.path(user, "03 R Code"))
# Define file paths
file_building <- "01 Raw/ariadne_panel1_buildingchars_eng_update24.dta"
file_refurb   <- "01 Raw/ariadne_panel1_experiments_eng_update24.dta"
# Global flag: control whether 01_WuW_Data recodes missing values
run_missing_imputation <<- TRUE
rules <<- "Fehlende Werte.xlsx"   # Roof, Top Floor, External Walls, Basement
u_werte_all <<- "U Werte Baukonstruktion_update.xlsx"   # Roof, Top Floor, External Walls, Basement
u_werte_f   <<- "U und G Werte Fenster_update.xlsx"     # Windows
# Run the pipeline
source("01_WuW_Data.R")
View(d1)
###############################################################################
#
# Title: 00 Master File
#
# Description: Master file for executing all scripts to calculate final energy demand.
#
# Last update: 24 June 2024
# Authors: Maximilian Dreher, Rene Ladwig, Martina Milcetic (and a little bit Anton Knoche)
#
###############################################################################
# Clean up the working environment
rm(list = ls())
# Change to the directory of this master file
setwd(dirname(rstudioapi::getActiveDocumentContext()$path))
# Change to project root (one level up)
setwd("..")
# Base path
user <- getwd()
# Install packages from local zips if not already present (kept behavior)
pkg_files <- list.files("R packages", pattern = "\\.zip$", full.names = TRUE)
for (f in pkg_files) {
install.packages(f, repos = NULL, type = "binary")
}
# Load packages
packages <- c(
"Rcpp", "zip", "data.table", "foreign", "haven",
"labelled", "openxlsx", "readxl", "tidyverse", "dplyr"
)
lapply(packages, library, character.only = TRUE)
# Source files from folder "03 R Code"
setwd(file.path(user, "03 R Code"))
# Define file paths
file_building <- "01 Raw/ariadne_panel1_buildingchars_eng_update24.dta"
file_refurb   <- "01 Raw/ariadne_panel1_experiments_eng_update24.dta"
# Global flag: control whether 01_WuW_Data recodes missing values
run_missing_imputation <<- TRUE
rules <<- "Fehlende Werte.xlsx"   # Roof, Top Floor, External Walls, Basement
u_werte_all <<- "U Werte Baukonstruktion_update.xlsx"   # Roof, Top Floor, External Walls, Basement
u_werte_f   <<- "U und G Werte Fenster_update.xlsx"     # Windows
# Run the pipeline
source("01_WuW_Data.R")
source("02_Individual_Parameters.R")
source("03_System_Technology.R")
source("04_Building_Balance_Sheet.R")
source("05_System_Balance_Sheet.R")
shiny::runApp('C:/Users/antonkn/Desktop/EBJ/EBJ Package V2')
runApp('C:/Users/antonkn/Desktop/EBJ/EBJ Package V2')
shiny::runApp()
runApp()
shiny::runApp()
shiny::runApp()
shiny::runApp()
shiny::runApp()
shiny::runApp()
shiny::runApp()
runApp()
shiny::runApp()
shiny::runApp()
# Initialize renv for reproducible environments
if (!requireNamespace("renv", quietly = TRUE)) {
install.packages("renv", repos = "https://cloud.r-project.org")
}
shiny::runApp()
shiny::runApp()
shiny::runApp()
shiny::runApp()
shiny::runApp()
